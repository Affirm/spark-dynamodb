box: bigtruedata/sbt:0.13.15-2.11

build:
  steps:
    - script:
      name: Compile
      code: |
        sbt clean compile

publish-snapshot:
  steps:
    - script:
      name: Keygen
      code: |
        mkdir -p ~/.sbt/0.13/plugins/
        touch ~/.sbt/0.13/plugins/plugins.sbt
        echo 'addSbtPlugin("com.jsuereth" % "sbt-pgp" % "1.0.0")' >> ~/.sbt/0.13/plugins/plugins.sbt
        touch .keygen
        echo 'set pgpReadOnly := false' >> .keygen
        echo 'pgp-cmd gen-key' >> .keygen
        echo '$NEXUS_USER' >> .keygen
        echo '$NEXUS_EMAIL' >> .keygen
        echo '$NEXUS_PASSPHRASE' >> .keygen
        echo '$NEXUS_PASSPHRASE' >> .keygen
        sbt < .keygen
        rm .keygen
    - audienceproject/sbt-to-maven-central@1.0.1:
      user: $NEXUS_USER
      password: $NEXUS_PASSWORD
      private-key: $NEXUS_PK
      passphrase: $NEXUS_PASSPHRASE

publish-release:
  steps:
    - script:
      name: Keygen
      code: |
        mkdir -p ~/.sbt/0.13/plugins/
        touch ~/.sbt/0.13/plugins/plugins.sbt
        echo 'addSbtPlugin("com.jsuereth" % "sbt-pgp" % "1.0.0")' >> ~/.sbt/0.13/plugins/plugins.sbt
        touch .keygen
        echo 'set pgpReadOnly := false' >> .keygen
        echo 'pgp-cmd gen-key' >> .keygen
        echo '$NEXUS_USER' >> .keygen
        echo '$NEXUS_EMAIL' >> .keygen
        echo '$NEXUS_PASSPHRASE' >> .keygen
        echo '$NEXUS_PASSPHRASE' >> .keygen
        sbt < .keygen
        rm .keygen
    - audienceproject/sbt-to-maven-central@1.0.1:
      user: $NEXUS_USER
      password: $NEXUS_PASSWORD
      private-key: $NEXUS_PK
      passphrase: $NEXUS_PASSPHRASE
      destination: RELEASE